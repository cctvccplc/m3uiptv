<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset='utf-8'/>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' name='viewport'/>
    <title>IPTV PRO - Fixed Playlists</title>
    
    <script src='https://cdn.jsdelivr.net/npm/hls.js@latest'></script>
    <script src='https://cdn.jsdelivr.net/npm/dashjs@latest/dist/dash.all.min.js'></script>

    <style>
    :root { --panel-bg: rgba(12, 12, 12, 0.98); --accent: #3b82f6; --glass: rgba(255, 255, 255, 0.08); --bg: #0a0a0a; }
    body, html { margin: 0; padding: 0; background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; touch-action: pan-y; }
    
    #loader { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

    #player-container { position: fixed; inset: 0; z-index: 1; background: #000; }
    video { width: 100%; height: 100%; object-fit: contain; }

    .overlay-panel { position: fixed; top: 0; bottom: 0; z-index: 100; background: var(--panel-bg); width: 280px; transform: translateX(-100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); border-right: 1px solid #333; backdrop-filter: blur(20px); }
    .overlay-panel.show { transform: translateX(0); }
    
    .search-box { padding: 15px; border-bottom: 1px solid #333; }
    .search-box input { width: 100%; padding: 10px; background: #222; border: 1px solid #444; border-radius: 8px; color: #fff; outline: none; }

    .nav-header { padding: 20px; font-weight: bold; border-bottom: 1px solid #333; color: var(--accent); }
    .list-container { height: calc(100% - 70px); overflow-y: auto; padding: 15px; }
    
    .item { padding: 12px; margin-bottom: 8px; border-radius: 10px; display: flex; align-items: center; cursor: pointer; background: var(--glass); outline: none; border: 2px solid transparent; }
    .item:focus { border-color: var(--accent); background: rgba(59, 130, 246, 0.2); }
    .item img { width: 35px; height: 35px; margin-right: 12px; border-radius: 5px; }

    .pip-btn { position: fixed; bottom: 20px; right: 20px; z-index: 101; background: var(--accent); border: none; color: #fff; padding: 10px; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body onclick='handleGlobalClick(event)'>

    <div id="loader"></div>

    <div id='player-container'>
        <video autoplay id='player' playsinline></video>
    </div>

    <button class="pip-btn" id="pip_btn" onclick="togglePiP()">üì∫</button>

    <div class='overlay-panel' id='category-nav'>
        <div class='nav-header'>üì° MULTI PLAYLIST</div>
        <div class='list-container' id='category_list'>
            <div class="item cat-item" tabindex="0" onclick="loadFixedSource(0, this)">üìÅ Dish TV</div>
            <div class="item cat-item" tabindex="0" onclick="loadFixedSource(1, this)">üìÅ Arabic Sports</div>
            <div class="item cat-item" tabindex="0" onclick="loadFixedSource(2, this)">üìÅ Bangla BD26</div>
        </div>
    </div>

    <div class='overlay-panel' id='channel-nav'>
        <div class='search-box'>
            <input type="text" id="channel_search" placeholder="Search channel..." onkeyup="filterChannels()" tabindex="0">
        </div>
        <div class='list-container' id='channel_list'></div>
    </div>

    <script>
    const fixedPlaylists = [
        "https://raw.githubusercontent.com/alex8875/m3u/refs/heads/main/dishtv.m3u",
        "https://omnix-playlist-server.pages.dev/playlist/omnixott-Arabic_Sports.m3u",
        "https://raw.githubusercontent.com/cctvccplc/Tv-Test/refs/heads/main/BD26.m3u8"
    ];

    let allChannels = [], hls, dash, hideTimeout;
    let lastChannelFocus = null, lastCategoryFocus = null;
    let touchStartX = 0, touchEndX = 0;

    window.onload = () => loadFixedSource(0); // ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá

    async function loadFixedSource(index, el = null) {
        if(el) lastCategoryFocus = el;
        showLoader(true);
        try {
            const res = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(fixedPlaylists[index]));
            const data = await res.text();
            parseM3U(data);
            renderChannels(allChannels);
            if(allChannels.length > 0) playChannel(allChannels[0].url, null, true);
            showLoader(false);
        } catch(e) { 
            showLoader(false); 
            console.error("Playlist Load Failed");
        }
    }

    function parseM3U(data) {
        allChannels = [];
        let lines = data.split("\n");
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].startsWith("#EXTINF")) {
                let info = {
                    name: lines[i].split(",").pop().trim(),
                    logo: lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "https://cdn-icons-png.flaticon.com/512/716/716429.png"
                };
                for (let j = i + 1; j < lines.length; j++) {
                    if (lines[j].trim().startsWith("http")) { 
                        info.url = lines[j].trim(); 
                        allChannels.push(info); 
                        i = j; break; 
                    }
                }
            }
        }
    }

    function renderChannels(list, el = null) {
        if(el) lastCategoryFocus = el;
        const cl = document.getElementById("channel_list");
        cl.innerHTML = list.map(ch => `
            <div class="item ch-item" tabindex="0" onclick='playChannel("${ch.url}", this)'>
                <img src="${ch.logo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/716/716429.png'">
                <span>${ch.name}</span>
            </div>`).join('');
        showChannels(false);
    }

    function filterChannels() {
        const query = document.getElementById("channel_search").value.toLowerCase();
        const filtered = allChannels.filter(ch => ch.name.toLowerCase().includes(query));
        renderChannels(filtered);
    }

    function playChannel(url, el, isAuto = false) {
        if(el) lastChannelFocus = el;
        showLoader(true);
        const video = document.getElementById("player");
        if(hls) hls.destroy(); if(dash) dash.reset();
        
        if(url.includes(".m3u8")) {
            if(Hls.isSupported()) { 
                hls = new Hls(); hls.loadSource(url); hls.attachMedia(video); 
                hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
            } else { video.src = url; video.play(); }
        } else if(url.includes(".mpd")) {
            dash = dashjs.MediaPlayer().create(); dash.initialize(video, url, true);
        } else { video.src = url; video.play(); }
        
        video.onplaying = () => showLoader(false);
        if(!isAuto) hideMenus();
    }

    // Keyboard & Swipe Control
    document.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; });
    document.addEventListener('touchend', e => {
        touchEndX = e.changedTouches[0].screenX;
        const swipe = touchEndX - touchStartX;
        if (swipe > 100) showChannels(true);
        else if (swipe < -100) hideMenus();
    });

    window.addEventListener("keydown", (e) => {
        const isCatShow = document.getElementById("category-nav").classList.contains("show");
        const isChShow = document.getElementById("channel-nav").classList.contains("show");
        if(!isCatShow && !isChShow && ["ArrowUp", "ArrowDown", "Enter"].includes(e.key)) { showChannels(true); return; }
        
        const active = document.activeElement;
        if (e.key === "ArrowDown") {
            e.preventDefault();
            if (active.nextElementSibling) { active.nextElementSibling.focus(); active.nextElementSibling.scrollIntoView({ block: "nearest" }); }
        } else if (e.key === "ArrowUp") {
            e.preventDefault();
            if (active.previousElementSibling) { active.previousElementSibling.focus(); active.previousElementSibling.scrollIntoView({ block: "nearest" }); }
        } else if (e.key === "ArrowLeft") { isChShow ? showCategories(true) : hideMenus(); }
        else if (e.key === "ArrowRight" && isCatShow) showChannels(true);
        else if (e.key === "Enter") active.click();
        else if (e.key === "Escape") hideMenus();
        resetTimer();
    });

    function showChannels(restore = true) {
        hideMenus(); 
        document.getElementById("channel-nav").classList.add("show");
        setTimeout(() => {
            let target = (restore && lastChannelFocus) ? lastChannelFocus : document.querySelector(".ch-item");
            if(target) target.focus();
        }, 200);
    }

    function showCategories(restore = true) {
        hideMenus(); 
        document.getElementById("category-nav").classList.add("show");
        setTimeout(() => {
            let target = (restore && lastCategoryFocus) ? lastCategoryFocus : document.querySelector(".cat-item");
            if(target) target.focus();
        }, 200);
    }

    function showLoader(show) { document.getElementById('loader').style.display = show ? 'block' : 'none'; }
    function hideMenus() { document.querySelectorAll(".overlay-panel").forEach(p => p.classList.remove("show")); }
    function resetTimer() { clearTimeout(hideTimeout); hideTimeout = setTimeout(hideMenus, 5000); }
    function togglePiP() {
        const video = document.getElementById('player');
        if (document.pictureInPictureElement) document.exitPictureInPicture();
        else video.requestPictureInPicture();
    }
    function handleGlobalClick(e) { 
        if(!e.target.closest('.overlay-panel')) {
            if(!document.querySelector(".overlay-panel.show")) showChannels(true);
        }
    }
    </script>
</body>
</html>
