<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset='utf-8'/>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' name='viewport'/>
    <title>IPTV PRO - Classic Navigation</title>
    
    <script src='https://cdn.jsdelivr.net/npm/hls.js@latest'></script>
    <script src='https://cdn.jsdelivr.net/npm/dashjs@latest/dist/dash.all.min.js'></script>

    <style>
    :root { --panel-bg: rgba(12, 12, 12, 0.98); --accent: #3b82f6; --glass: rgba(255, 255, 255, 0.1); --bg: #0a0a0a; }
    body, html { margin: 0; padding: 0; background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; }
    
    #loader { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }

    #player-container { position: fixed; inset: 0; z-index: 1; background: #000; }
    video { width: 100%; height: 100%; object-fit: contain; }

    .overlay-panel { position: fixed; top: 0; bottom: 0; left: 0; z-index: 100; background: var(--panel-bg); width: 300px; transform: translateX(-100%); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); border-right: 1px solid #333; backdrop-filter: blur(20px); }
    .overlay-panel.show { transform: translateX(0); }
    
    .nav-header { padding: 20px; font-weight: bold; border-bottom: 1px solid #333; color: var(--accent); font-size: 18px; display: flex; align-items: center; justify-content: space-between; }
    .list-container { height: calc(100% - 70px); overflow-y: auto; padding: 15px; }
    
    .search-box { padding: 10px 15px; border-bottom: 1px solid #333; }
    .search-box input { width: 100%; padding: 10px; background: #222; border: 1px solid #444; border-radius: 8px; color: #fff; outline: none; }

    .item { padding: 12px; margin-bottom: 8px; border-radius: 10px; display: flex; align-items: center; cursor: pointer; background: var(--glass); outline: none; border: 2px solid transparent; }
    .item:focus, .item:hover { border-color: var(--accent); background: rgba(59, 130, 246, 0.2); }
    .item img { width: 35px; height: 35px; margin-right: 12px; border-radius: 5px; object-fit: cover; }
    
    .back-btn { background: #333; color: #fff; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; }
    .pip-btn { position: fixed; bottom: 20px; right: 20px; z-index: 101; background: var(--accent); border: none; color: #fff; padding: 12px; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body onclick='handleGlobalClick(event)'>

    <div id="loader"></div>

    <div id='player-container'>
        <video autoplay id='player' playsinline></video>
    </div>

    <button class="pip-btn" onclick="togglePiP()">üì∫</button>

    <div class='overlay-panel' id='main-nav'>
        <div class='nav-header'>
            <span id="nav-title">PLAYLISTS</span>
            <button id="back-nav-btn" class="back-btn" style="display:none;" onclick="goBack()">Back</button>
        </div>
        <div class='search-box' id="search-area" style="display:none;">
            <input type="text" id="channel_search" placeholder="Search..." onkeyup="filterList()">
        </div>
        <div class='list-container' id='main_list'></div>
    </div>

    <script>
    const playlists = [
        { name: "Dish TV", url: "https://raw.githubusercontent.com/alex8875/m3u/refs/heads/main/dishtv.m3u" },
        { name: "Arabic Sports", url: "https://omnix-playlist-server.pages.dev/playlist/omnixott-Arabic_Sports.m3u" },
        { name: "Bangla BD26", url: "https://raw.githubusercontent.com/cctvccplc/Tv-Test/refs/heads/main/BD26.m3u8" }
    ];

    let allChannels = [], currentFilteredChannels = [], hls, dash, currentLevel = 'playlists'; 

    window.onload = () => {
        renderPlaylists();
        loadInitialPlaylist(0);
    };

    function renderPlaylists() {
        currentLevel = 'playlists';
        document.getElementById('nav-title').innerText = "PLAYLISTS";
        document.getElementById('back-nav-btn').style.display = "none";
        document.getElementById('search-area').style.display = "none";
        
        const container = document.getElementById('main_list');
        container.innerHTML = playlists.map((pl, idx) => `
            <div class="item" tabindex="0" onclick="fetchPlaylistData(${idx})">
                <span>üìÅ ${pl.name}</span>
            </div>
        `).join('');
    }

    async function fetchPlaylistData(index) {
        showLoader(true);
        try {
            const res = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(playlists[index].url));
            const data = await res.text();
            parseM3U(data);
            renderCategories(playlists[index].name);
            showLoader(false);
        } catch(e) { showLoader(false); alert("Error loading playlist."); }
    }

    async function loadInitialPlaylist(index) {
        const res = await fetch("https://api.allorigins.win/raw?url=" + encodeURIComponent(playlists[index].url));
        const data = await res.text();
        parseM3U(data);
        if(allChannels.length > 0) playChannel(allChannels[0].url, null, true);
    }

    function parseM3U(data) {
        allChannels = [];
        const lines = data.split("\n");
        let currentGroup = "General";
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].startsWith("#EXTINF")) {
                const groupMatch = lines[i].match(/group-title="([^"]+)"/);
                currentGroup = groupMatch ? groupMatch[1] : "General";
                const name = lines[i].split(",").pop().trim();
                const logo = lines[i].match(/tvg-logo="([^"]+)"/)?.[1] || "";
                for (let j = i + 1; j < lines.length; j++) {
                    if (lines[j].trim().startsWith("http")) {
                        allChannels.push({ name, logo, group: currentGroup, url: lines[j].trim() });
                        i = j; break;
                    }
                }
            }
        }
    }

    function renderCategories(plName) {
        currentLevel = 'categories';
        document.getElementById('nav-title').innerText = plName;
        document.getElementById('back-nav-btn').style.display = "block";
        
        const groups = [...new Set(allChannels.map(ch => ch.group))].sort();
        const container = document.getElementById('main_list');
        let html = `<div class="item" tabindex="0" onclick="renderChannels('All')">üè† All Channels</div>`;
        groups.forEach(g => {
            html += `<div class="item" tabindex="0" onclick="renderChannels('${g}')">üìÅ ${g}</div>`;
        });
        container.innerHTML = html;
        container.scrollTo(0,0);
    }

    function renderChannels(group) {
        currentLevel = 'channels';
        document.getElementById('nav-title').innerText = group;
        document.getElementById('search-area').style.display = "block";
        
        currentFilteredChannels = group === 'All' ? allChannels : allChannels.filter(ch => ch.group === group);
        displayChannelList(currentFilteredChannels);
    }

    function displayChannelList(list) {
        const container = document.getElementById('main_list');
        container.innerHTML = list.map(ch => `
            <div class="item" tabindex="0" onclick='playChannel("${ch.url}", this)'>
                <img src="${ch.logo}" onerror="this.src='https://cdn-icons-png.flaticon.com/512/716/716429.png'">
                <span>${ch.name}</span>
            </div>`).join('');
        container.scrollTo(0,0);
    }

    function filterList() {
        const q = document.getElementById("channel_search").value.toLowerCase();
        const filtered = currentFilteredChannels.filter(ch => ch.name.toLowerCase().includes(q));
        displayChannelList(filtered);
    }

    function goBack() {
        if(currentLevel === 'channels') renderCategories(document.getElementById('nav-title').innerText);
        else if(currentLevel === 'categories') renderPlaylists();
    }

    function playChannel(url, el, isAuto = false) {
        showLoader(true);
        const video = document.getElementById("player");
        if(hls) hls.destroy(); if(dash) dash.reset();
        
        if(url.includes(".m3u8")) {
            if(Hls.isSupported()) { 
                hls = new Hls(); hls.loadSource(url); hls.attachMedia(video); 
                hls.on(Hls.Events.MANIFEST_PARSED,()=>video.play());
            } else { video.src = url; video.play(); }
        } else if(url.includes(".mpd")) {
            dash = dashjs.MediaPlayer().create(); dash.initialize(video, url, true);
        } else { video.src = url; video.play(); }
        
        video.onplaying = () => showLoader(false);
        if(!isAuto) hideMenus();
    }

    function showNav() { document.getElementById("main-nav").classList.add("show"); document.querySelector(".item")?.focus(); }
    function hideMenus() { document.getElementById("main-nav").classList.remove("show"); }
    function showLoader(show) { document.getElementById('loader').style.display = show ? 'block' : 'none'; }
    function togglePiP() { const v = document.getElementById('player'); document.pictureInPictureElement ? document.exitPictureInPicture() : v.requestPictureInPicture(); }

    window.addEventListener("keydown", (e) => {
        const isShow = document.getElementById("main-nav").classList.contains("show");
        if(!isShow && ["ArrowUp", "ArrowDown", "ArrowLeft", "Enter"].includes(e.key)) { showNav(); return; }
        
        const active = document.activeElement;
        if (e.key === "ArrowDown") {
            e.preventDefault();
            if (active.nextElementSibling) { active.nextElementSibling.focus(); active.nextElementSibling.scrollIntoView({ block: "nearest" }); }
        } else if (e.key === "ArrowUp") {
            e.preventDefault();
            if (active.previousElementSibling) { active.previousElementSibling.focus(); active.previousElementSibling.scrollIntoView({ block: "nearest" }); }
        } else if (e.key === "ArrowLeft") { goBack(); }
        else if (e.key === "Enter") active.click();
        else if (e.key === "Escape") hideMenus();
    });

    function handleGlobalClick(e) { 
        if(!e.target.closest('.overlay-panel') && !e.target.closest('.pip-btn')) {
            const isShow = document.getElementById("main-nav").classList.contains("show");
            isShow ? hideMenus() : showNav();
        }
    }
    </script>
</body>
</html>
